import{a as v}from"./chunk-C7PA73U5.js";import{a as h}from"./chunk-7V6ATNCQ.js";import{_ as I}from"./chunk-IWL4SBPM.js";import{c as T}from"./chunk-S5MVYYKB.js";import{d as k,v as g}from"./chunk-H7UAIGYQ.js";import{Ma as l,_ as f,da as u}from"./chunk-L7ST2L6E.js";var x=(()=>{class s{constructor(e,t){this.document=e,this.platformId=t,this.documentIsAccessible=g(this.platformId)}static getCookieRegExp(e){let t=e.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+t+"|;\\s*"+t+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(e){try{return decodeURIComponent(e)}catch{return e}}check(e){return this.documentIsAccessible?(e=encodeURIComponent(e),s.getCookieRegExp(e).test(this.document.cookie)):!1}get(e){if(this.documentIsAccessible&&this.check(e)){e=encodeURIComponent(e);let o=s.getCookieRegExp(e).exec(this.document.cookie);return o[1]?s.safeDecodeURIComponent(o[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let e={},t=this.document;return t.cookie&&t.cookie!==""&&t.cookie.split(";").forEach(o=>{let[r,c]=o.split("=");e[s.safeDecodeURIComponent(r.replace(/^ /,""))]=s.safeDecodeURIComponent(c)}),e}set(e,t,o,r,c,p,m,R){if(!this.documentIsAccessible)return;if(typeof o=="number"||o instanceof Date||r||c||p||m){let d={expires:o,path:r,domain:c,secure:p,sameSite:m||"Lax",partitioned:R};this.set(e,t,d);return}let a=encodeURIComponent(e)+"="+encodeURIComponent(t)+";",i=o||{};if(i.expires)if(typeof i.expires=="number"){let d=new Date(new Date().getTime()+i.expires*1e3*60*60*24);a+="expires="+d.toUTCString()+";"}else a+="expires="+i.expires.toUTCString()+";";i.path&&(a+="path="+i.path+";"),i.domain&&(a+="domain="+i.domain+";"),i.secure===!1&&i.sameSite==="None"&&(i.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${e} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),i.secure&&(a+="secure;"),i.sameSite||(i.sameSite="Lax"),a+="sameSite="+i.sameSite+";",i.partitioned&&(a+="Partitioned;"),this.document.cookie=a}delete(e,t,o,r,c="Lax"){if(!this.documentIsAccessible)return;let p=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(e,"",{expires:p,path:t,domain:o,secure:r,sameSite:c})}deleteAll(e,t,o,r="Lax"){if(!this.documentIsAccessible)return;let c=this.getAll();for(let p in c)c.hasOwnProperty(p)&&this.delete(p,e,t,o,r)}static{this.\u0275fac=function(t){return new(t||s)(u(k),u(l))}}static{this.\u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var A=class s{constructor(n,e,t,o){this.Http=n;this.Router=e;this.cookieService=t;this.toast=o}accessTokenKey="accessToken";refreshTokenKey="refreshToken";userIdKey="userId";SignIn(n){return this.Http.post(`${h.apiUrl}authentication/sign-in`,n)}saveTokens(n){let e=n.data.accessToken,t=n.data.refreshToken.tokenString,o=n.data.userId,r=new Date(n.data.refreshToken.expireAt);this.setAutoLogout(r),this.cookieService.set("accessToken",e,r,"/","",!1,"Strict"),this.cookieService.set("refreshToken",t,r,"/"),this.cookieService.set("userId",o,r,"/")}setAutoLogout(n){let e=new Date(n).getTime()-Date.now();console.log(`Time until expiry: ${e} milliseconds`),e==0&&setTimeout(()=>{this.toast.info("Authentication","Your session has expired. Please log in again."),this.logout()},e)}getAccessToken(){return this.cookieService.get("accessToken")||null}refreshToken(){let n=this.getAccessToken(),e=this.getRefreshToken(),t=new FormData;return t.append("AccessToken",n??""),t.append("RefreshToken",e??""),this.Http.post(`${h.apiUrl}authentication/refresh-token`,t)}getRefreshToken(){return this.cookieService.get("refreshToken")||null}logout(){this.cookieService.delete("accessToken"),this.cookieService.delete("refreshToken"),this.cookieService.delete("userId"),this.Router.navigate(["/Auth/Sign-In"])}isLoggedIn(){return!!this.getAccessToken()}static \u0275fac=function(e){return new(e||s)(u(T),u(I),u(x),u(v))};static \u0275prov=f({token:s,factory:s.\u0275fac,providedIn:"root"})};export{A as a};
